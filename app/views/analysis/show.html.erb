<!-- app/views/analysis/show.html.erb -->
<div class="zk-wrapper">
  <div class="zk-card">
    <!-- ヘッダー -->
    <header class="zk-header">
      <h1 class="zk-title">ズボ楽家計簿</h1>
    </header>

    <!-- 明細テーブル -->
    <section class="zk-section">
      <h2 class="zk-section-label">明細</h2>

      <div class="zk-table-container">
        <table class="zk-table">
          <thead>
            <tr>
              <th>日付</th>
              <th>内容</th>
              <th>項目</th>
              <th>金額</th>
            </tr>
          </thead>
          <tbody>
            <% @entries.each do |entry| %>
              <tr>
                <td><%= entry.occurred_on&.strftime("%-m/%-d") %></td>
                <td><%= entry.description %></td>
                <td><%= entry_category_label(entry) %></td>

                <td class="zk-table-col-right">
                  <% css = entry.direction == "income" ? "zk-amount-income" : "zk-amount-expense" %>
                  <span class="<%= css %>">
                    <%= number_with_delimiter(entry.amount) %>
                  </span>

                  <!-- 編集アイコン（リンク付き） -->
                  <%= link_to edit_entry_path(entry), class: "zk-edit-icon" do %>
                    <i class="fa-solid fa-pen"></i>
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </section>

    <!-- 🔽 分析対象月セレクト + 分析ボタン -->
    <section class="zk-section zk-section-analysis-button">

      <%= form_with url: analysis_path, method: :post, local: true do %>
        <div class="zk-field">
          <label class="zk-field-label">分析する月</label>
          <%= select_tag :month,
                options_for_select(@month_options, @selected_month_param),
                class: "zk-input" %>
        </div>

        <!-- ✅ ボタンは常に押せる。実際の制限は create 側で行う -->
        <%= submit_tag "分析", class: "zk-analysis-button" %>
      <% end %>

      <p class="zk-analysis-note">
        <% if @remaining_analyses.zero? %>
          本日の分析回数（3回）を使い切りました。
        <% else %>
          本日はあと <%= @remaining_analyses %> 回まで分析できます。
        <% end %>
      </p>
    </section>

    <!-- 🔽 分析した月の見出し -->
    <section class="zk-section">
      <h2 class="zk-section-label">
        <%= @analysis_month_label || "分析結果" %>
      </h2>

      <div class="zk-analysis-block">
        <p class="zk-analysis-heading">○良い点</p>
        <p><%= @good_point %></p>
      </div>

      <div class="zk-analysis-block">
        <p class="zk-analysis-heading">○改善点</p>
        <p><%= @improve_point %></p>
      </div>
    </section>
  </div>

  <%= render "shared/bottom_nav" %>
</div>
